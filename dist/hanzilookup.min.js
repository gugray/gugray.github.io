"use strict";var HanziLookup=HanziLookup||{};HanziLookup.AnalyzedCharacter=function(r){function t(r){for(var t=0;t!=r.length;++t)for(var n=0;n!=r[t].length;++n){var a=r[t][n];a[0]<c&&(c=a[0]),a[0]>p&&(p=a[0]),a[1]<l&&(l=a[1]),a[1]>E&&(E=a[1])}}function n(r,t){var n=r[0]-t[0],a=r[1]-t[1];return Math.sqrt(n*n+a*a)}function a(r,t){var a=p-c,o=E-l,e=a>o?a*a:o*o,u=Math.sqrt(e+e),h=n(r,t)/u;return Math.min(h,1)}function o(r,t){var n=r[0]-t[0],a=r[1]-t[1],o=Math.atan2(a,n);return Math.PI-o}function e(r){for(var t=[],a=0;a!=r.length;++a)t.push(!1);var o=0,e=0,u=1;t[0]=!0;for(var h=n(r[e],r[u]),i=h,a=2;a<r.length;++a){var l=r[a],E=n(r[u],l);h+=E,i+=E;var c=n(r[o],l),p=n(r[e],l);(h>f*c||i>s*p)&&(t[o]&&n(r[o],r[u])<v&&(t[o]=!1),t[u]=!0,i=E,e=u),h=E,o=u,u=a}t[u]=!0,t[o]&&n(r[o],r[u])<v&&0!=o&&(t[o]=!1);for(var N=[],a=0;a!=t.length;++a)t[a]&&N.push(a);return N}function u(r,t){var n,a=(r[0]+t[0])/2,o=(r[1]+t[1])/2;if(p-c>E-l){n=p-c;var e=E-l;a-=c,o=o-l+(n-e)/2}else{n=E-l;var u=p-c;a=a-c+(n-u)/2,o-=l}return[a/n,o/n]}function h(r,t){for(var n=[],e=0,h=0;h!=t.length;++h){var i=t[h];if(i!=e){var v=o(r[e],r[i]),f=a(r[e],r[i]),s=u(r[e],r[i]);n.push(new HanziLookup.SubStroke(v,f,s[0],s[1])),e=i}}return n}function i(r){for(var t=0;t!=r.length;++t){var n=e(r[t]),a=h(r[t],n);g+=a.length,N.push(new HanziLookup.AnalyzedStroke(r[t],n,a))}}var v=12.5,f=1.1,s=1.09,l=Number.MAX_SAFE_INTEGER,E=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,p=Number.MIN_SAFE_INTEGER,N=[],g=0;t(r),i(r),this.top=l<=250?l:0,this.bottom=E>=0?E:250,this.left=c<=250?c:0,this.right=p>=0?p:250,this.analyzedStrokes=N,this.subStrokeCount=g};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.AnalyzedStroke=function(o,i,t){this.points=o,this.pivotIndexes=i,this.subStrokes=t};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.CharacterMatch=function(a,o){this.character=a,this.score=o};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.CubicCurve2D=function(t,n,r,u,o,e,a,i){function c(){return F-w-f()-p()}function h(){return H-l-s()-M()}function f(){return 3*(z-g)-p()}function s(){return 3*(C-k)-M()}function p(){return 3*(g-w)}function M(){return 3*(k-l)}function v(t){var n=[],r=c(),u=f(),o=p(),e=w-t,a=(3*o/r-u*u/(r*r))/3,i=(2*u*u*u/(r*r*r)-9*u*o/(r*r)+27*e/r)/27,h=i*i/4+a*a*a/27;if(h>0){var s=0-i,M=s/2+Math.pow(h,.5),v=Math.pow(M,.3333333333333333),l=v,g=s/2-Math.pow(h,.5),k=Math.pow(0-g,.3333333333333333),z=k,C=l-z-u/(3*r);n.push(C)}else if(0==a&&0==i&&0==h)n.push(-Math.pow(e/r,1/3));else{var F=Math.sqrt(i*i/4-h),H=Math.pow(F,1/3),L=Math.acos(-i/(2*F)),q=H*-1,x=Math.cos(L/3),N=Math.sqrt(3)*Math.sin(L/3),X=u/(3*r)*-1;n.push(2*H*Math.cos(L/3)-u/(3*r)),n.push(q*(x+N)+X),n.push(q*(x-N)+X)}return n}var w=t,l=n,g=r,k=u,z=o,C=e,F=a,H=i;return{x1:function(){return w},x2:function(){return F},getYOnCurve:function(t){var n=h(),r=s(),u=M(),o=t*t,e=t*o,a=n*e+r*o+u*t+l;return a},solveForX:function(t){return v(t)},getFirstSolutionForX:function(t){for(var n=v(t),r=0;r!=n.length;++r){var u=n[r];if(u>=-1e-8&&u<=1.00000001)return u>=0&&u<=1?u:u<0?0:1}return NaN}}};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.DrawingBoard=function(e,t){function n(){h.clearRect(0,0,h.canvas.width,h.canvas.height),h.setLineDash([1,1]),h.lineWidth=.5,h.strokeStyle="grey",h.beginPath(),h.moveTo(0,0),h.lineTo(h.canvas.width,0),h.lineTo(h.canvas.width,h.canvas.height),h.lineTo(0,h.canvas.height),h.lineTo(0,0),h.stroke(),h.beginPath(),h.moveTo(0,0),h.lineTo(h.canvas.width,h.canvas.height),h.stroke(),h.beginPath(),h.moveTo(h.canvas.width,0),h.lineTo(0,h.canvas.height),h.stroke(),h.beginPath(),h.moveTo(h.canvas.width/2,0),h.lineTo(h.canvas.width/2,h.canvas.height),h.stroke(),h.beginPath(),h.moveTo(0,h.canvas.height/2),h.lineTo(h.canvas.width,h.canvas.height/2),h.stroke()}function o(e,t){u=!0,T=[],f=[e,t],T.push(f),h.strokeStyle="grey",h.setLineDash([]),h.lineWidth=c,h.beginPath(),h.moveTo(e,t),l=new Date}function i(e,t){if(!((new Date).getTime()-l<50)){l=new Date;var n=[e,t];n[0]==f[0]&&n[1]==f[1]||(T.push(n),f=n,h.lineTo(e,t),h.stroke())}}function a(e,t){u=!1,e!=-1&&(h.lineTo(e,t),h.stroke(),T.push([e,t]),d.push(T),T=[],g&&g())}function s(){for(var e in d){h.strokeStyle="grey",h.setLineDash([]),h.lineWidth=c,h.beginPath(),h.moveTo(d[e][0][0],d[e][0][1]);for(var t=d[e].length,n=0;n<t-1;n++)h.lineTo(d[e][n][0],d[e][n][1]),h.stroke();h.lineTo(d[e][t-1][0],d[e][t-1][1]),h.stroke()}if(m){if(S&&(h.strokeStyle="blue",h.setLineDash([1,1]),h.lineWidth=.5,h.beginPath(),h.moveTo(m.left,m.top),h.lineTo(m.right,m.top),h.stroke(),h.lineTo(m.right,m.bottom),h.stroke(),h.lineTo(m.left,m.bottom),h.stroke(),h.lineTo(m.left,m.top),h.stroke()),b)for(var o=0;o!=m.xStrokes.length;++o){var i=m.xStrokes[o];h.strokeStyle="red",h.setLineDash([]),h.lineWidth=1,h.beginPath(),h.moveTo(i[0][0],i[0][1]),h.arc(i[0][0],i[0][1],3,0,2*Math.PI,!0),h.fillStyle="red",h.fill();for(var a=1;a<i.length;++a)h.lineTo(i[a][0],i[a][1]),h.stroke(),h.beginPath(),h.arc(i[a][0],i[a][1],3,0,2*Math.PI,!0),h.fillStyle="red",h.fill()}if(y&&m.yStrokes)for(var o=0;o!=m.yStrokes.length;++o){var s=m.yStrokes[o];h.strokeStyle="#e6cee6",h.setLineDash([]),h.lineWidth=c,h.beginPath(),h.moveTo(s[0][0],s[0][1]);for(var a=1;a<s.length;++a)h.lineTo(s[a][0],s[a][1]),h.stroke()}if(m.zStrokes)for(var o=0;o!=m.zStrokes.length;++o){var i=m.zStrokes[o];h.strokeStyle="green",h.setLineDash([]),h.lineWidth=1,h.beginPath(),h.moveTo(i[0][0],i[0][1]),h.arc(i[0][0],i[0][1],3,0,2*Math.PI,!0),h.fillStyle="green",h.fill();for(var a=1;a<i.length;++a)h.lineTo(i[a][0],i[a][1]),h.stroke(),h.beginPath(),h.arc(i[a][0],i[a][1],3,0,2*Math.PI,!0),h.fillStyle="green",h.fill()}}}var r,h,l,f,v=e,g=t,c=5,u=!1,k=-1,p=-1,d=[],T=null,m=null,b=!1,S=!1,y=!1;return r=$('<canvas class="stroke-input-canvas" width="250" height="250"></canvas>'),v.append(r),h=r[0].getContext("2d"),r.mousemove(function(e){if(u){var t=e.pageX-$(this).offset().left,n=e.pageY-$(this).offset().top;i(t,n)}}),r.mousedown(function(e){var t=e.pageX-$(this).offset().left,n=e.pageY-$(this).offset().top;o(t,n)}).mouseup(function(e){var t=e.pageX-$(this).offset().left,n=e.pageY-$(this).offset().top;a(t,n)}),r.bind("touchmove",function(e){if(u){e.preventDefault();var t=e.originalEvent.touches[0].pageX-$(this).offset().left;k=t;var n=e.originalEvent.touches[0].pageY-$(this).offset().top;p=n,i(t,n)}}),r.bind("touchstart",function(e){e.preventDefault(),document.activeElement.blur();var t=e.originalEvent.touches[0].pageX-$(this).offset().left,n=e.originalEvent.touches[0].pageY-$(this).offset().top;o(t,n)}).bind("touchend",function(e){e.preventDefault(),document.activeElement.blur(),a(k,p),k=p=-1}),n(),{clearCanvas:function(){d.length=0},undoStroke:function(){0!=d.length&&(d.length=d.length-1)},cloneStrokes:function(){for(var e=[],t=0;t!=d.length;++t){for(var n=[],o=0;o!=d[t].length;++o)n.push([d[t][o][0],d[t][o][1]]);e.push(n)}return e},redraw:function(){n(),s()},enrich:function(e,t,o,i){m=e,S=o,b=t,y=i,n(),s()}}};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.MatchCollector=function(r){function o(r){for(var o=Number.MAX_VALUE,t=-1,c=0;c!=n.length;++c){var u=n[c].score;if(u<o&&(o=u,t=c),n[c].character==r.character&&u<r.score)return void(n[c].score=r.score)}return n.length<e?void n.push(r):void(r.score>o&&(n[t]=r))}function t(){return n.sort(function(r,o){return o.score-r.score}),n}var e=r,n=[];return{fileMatch:function(r){o(r)},getMatches:function(){return t()}}};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.MAX_CHARACTER_STROKE_COUNT=48,HanziLookup.MAX_CHARACTER_SUB_STROKE_COUNT=64,HanziLookup.DEFAULT_LOOSENESS=.25,HanziLookup.AVG_SUBSTROKE_LENGTH=.33,HanziLookup.SKIP_PENALTY_MULTIPLIER=1.75,HanziLookup.CORRECT_NUM_STROKES_BONUS=.1,HanziLookup.CORRECT_NUM_STROKES_CAP=10,HanziLookup.Matcher=function(n,o){function a(n,o){var a=new HanziLookup.MatchCollector(o);if(0==n.analyzedStrokes.length)return a.getMatches();for(var u=[],i=0;i!=n.analyzedStrokes.length;++i)for(var _=n.analyzedStrokes[i],C=0;C!=_.subStrokes.length;++C)u.push(_.subStrokes[C]);for(var T=n.analyzedStrokes.length,S=n.subStrokeCount,R=r(T),E=Math.max(T-R,1),L=Math.min(T+R,HanziLookup.MAX_CHARACTER_STROKE_COUNT),h=t(S),H=Math.max(S-h,1),O=Math.min(S+h,HanziLookup.MAX_CHARACTER_SUB_STROKE_COUNT),A=0;A!=M.length;++A){var k=M[A],v=k[1],p=k[2];if(!(v<E||v>L||p.length<H||p.length>O)){if("å£«"==k[0]);var z=e(T,u,h,k);a.fileMatch(z)}}return a.getMatches()}function r(n){if(0==h)return 0;if(1==h)return HanziLookup.MAX_CHARACTER_STROKE_COUNT;var o=.35,a=.4*n,r=.6,t=n,u=new HanziLookup.CubicCurve2D(0,0,o,a,r,t,1,HanziLookup.MAX_CHARACTER_STROKE_COUNT),e=u.getFirstSolutionForX(h);return Math.round(u.getYOnCurve(e))}function t(n){if(1==h)return HanziLookup.MAX_CHARACTER_SUB_STROKE_COUNT;var o=.25*n,a=.4,r=1.5*o,t=.75,u=1.5*r,e=new HanziLookup.CubicCurve2D(0,o,a,r,t,u,1,HanziLookup.MAX_CHARACTER_SUB_STROKE_COUNT),i=e.getFirstSolutionForX(h);return Math.round(e.getYOnCurve(i))}function u(){for(var n=HanziLookup.MAX_CHARACTER_SUB_STROKE_COUNT+1,o=[],a=0;a<n;a++){o.push([]);for(var r=0;r<n;r++)o[a].push(0)}for(var a=0;a<n;a++){var t=-HanziLookup.AVG_SUBSTROKE_LENGTH*HanziLookup.SKIP_PENALTY_MULTIPLIER*a;o[a][0]=t,o[0][a]=t}return o}function e(n,o,a,r){var t=i(n,o,a,r);if(n==r[1]&&n<HanziLookup.CORRECT_NUM_STROKES_CAP){var u=HanziLookup.CORRECT_NUM_STROKES_BONUS*Math.max(HanziLookup.CORRECT_NUM_STROKES_CAP-n,0)/HanziLookup.CORRECT_NUM_STROKES_CAP;t+=u*t}return new HanziLookup.CharacterMatch(r[0],t)}function i(n,o,a,r){for(var t=0;t<o.length;t++)for(var u=o[t].direction,e=o[t].length,i=[o[t].centerX,o[t].centerY],C=0;C<r[2].length;C++){var T=Number.NEGATIVE_INFINITY;if(Math.abs(t-C)<=a){var S=r[2][C][0],R=r[2][C][1],E=null;r[2][C].length>2&&(E=[r[2][C][2],r[2][C][3]]);var L=H[t][C+1]-e*HanziLookup.SKIP_PENALTY_MULTIPLIER,h=H[t+1][C]-R*HanziLookup.SKIP_PENALTY_MULTIPLIER,M=Math.max(L,h),O=_(u,e,S,R,i,E),A=H[t][C];T=Math.max(A+O,M)}H[t+1][C+1]=T}return H[o.length][r[2].length]}function _(n,o,a,r,t,u){var e=S(n,a,o),i=R(o,r),_=i*e;if(u){var C=t[0]-u[0],T=t[1]-u[1],E=Math.sqrt(C*C+T*T),L=1-E;_>0?_*=L:_/=L}return _}function C(){var n=new HanziLookup.CubicCurve2D(0,1,.5,1,.25,(-2),1,1);E=T(n,100);var o=new HanziLookup.CubicCurve2D(0,0,.25,1,.75,1,1,1);L=T(o,100)}function T(n,o){for(var a=n.x1(),r=n.x2(),t=r-a,u=a,e=t/o,i=[],_=0;_<o;_++){var C=n.getFirstSolutionForX(Math.min(u,r));i.push(n.getYOnCurve(C)),u+=e}return i}function S(n,o,a){var r=Math.abs(n-o);r>Math.PI&&(r=2*Math.PI-r);var t=Math.round(r/Math.PI*(E.length-1)),u=E[t],e=Math.min(1,1-u),i=e*(-4*a+1);return i>0&&(u+=i),u}function R(n,o){var a=n<o?n/o:o/n,r=Math.round(a*(L.length-1)),t=L[r];return t}var E,L,h=o||HanziLookup.DEFAULT_LOOSENESS,M=n,H=u();return C(),{match:function(n,o){return a(n,o)}}};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.StrokeInputOverlay=function(t,o,i,s,h,r,e){this.top=t,this.right=o,this.bottom=i,this.left=s,this.xStrokes=h,this.yStrokes=r,this.zStrokes=e};
"use strict";var HanziLookup=HanziLookup||{};HanziLookup.SubStroke=function(t,i,n,o){this.direction=t,this.length=i,this.centerX=n,this.centerY=o};